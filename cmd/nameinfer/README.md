# nameinfer

`nameinfer` is a code generator that can be used to infer field names
for structs.
It searches for invocations of `govy.PropertyRules` constructors,
like `govy.For`, and follows the AST to find the field name which is returned
from `govy.PropertyGetter`.

It produces a single file with code registering all inferred field names.
It is important to make sure the generated file is loaded **BEFORE** any
`govy.PropertyRules` constructors are called.
Otherwise the inferred field names will not be available to the `govy` package.

## Installing

In order to install `nameinfer` generator, run:

```shell
go install github.com/nobl9/govy/cmd/nameinfer@latest
```

Alternatively you can use `tools.go` file to install the generator,
as described in [Go wiki](https://go.dev/wiki/Modules#how-can-i-track-tool-dependencies-for-a-module).

```go
//go:build tools

package main

import (
	_ "github.com/nobl9/govy/cmd/nameinfer"
)
```

## Usage

To generate a file with inferred field names, run the following command
from the root of your project:

```shell
nameinfer -dir <directory> -pkg <package> -filename <filename>
```

The following flags are available:

```text
Usage of nameinfer:
  -dir string
        directory path to save the generated file
  -filename string
        generated file name (default "govy_inferred_names.go")
  -pkg string
        package name of the generated file
```

## Example output file

```go
// Code generated by "nameinfer -dir . -pkg main"; DO NOT EDIT.

package main

import (
	"github.com/nobl9/govy/pkg/govyconfig"
)

func init() {
	inferredNames := map[string]govyconfig.InferredName{
		"student/nested.go:13": {
			Name: "name",
			File: "student/nested.go",
			Line: 13,
		},
		"university/university.go:13": {
			Name: "name",
			File: "university/university.go",
			Line: 13,
		},
		"validation.go:11": {
			Name: "Name",
			File: "validation.go",
			Line: 11,
		},
		"validation.go:13": {
			Name: "university.name",
			File: "validation.go",
			Line: 13,
		},
		"validation.go:15": {
			Name: "university",
			File: "validation.go",
			Line: 15,
		},
	}
	for _, name := range inferredNames {
		govyconfig.SetInferredName(name)
	}
}
```
